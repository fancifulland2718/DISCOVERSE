# DISCOVERSE 架构图

## 系统架构总览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           DISCOVERSE 仿真平台                                 │
│                    (Real2Sim2Real机器人学习框架)                            │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              应用层 (Application Layer)                      │
├─────────────────────────────────────────────────────────────────────────────┤
│  具体任务实现                                                                 │
│  ├── tasks_airbot_play/  │  ├── tasks_mmk2/     │  ├── tasks_hand_arm/     │
│  │   ├── place_cup      │  │   ├── kiwi_pick   │  │   ├── build_tower    │
│  │   ├── stack_block    │  │   ├── pan_pick    │  │   └── ...            │
│  │   └── ...            │  │   └── ...         │  └── ...                │
│  └── ...                │  └── ...             │                          │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              任务层 (Task Layer)                             │
├─────────────────────────────────────────────────────────────────────────────┤
│  任务基类和通用功能                                                           │
│  ├── AirbotPlayTaskBase  │  ├── MMK2TaskBase    │  ├── HandArmTaskBase    │
│  │   ├── 状态机管理      │  │   ├── 双臂协调    │  │   ├── 手臂协调      │
│  │   ├── 域随机化        │  │   ├── 移动控制    │  │   ├── 触觉反馈      │
│  │   └── 数据记录        │  │   └── 任务规划    │  │   └── 精细操作      │
│  └── ...                │  └── ...             │  └── ...                │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                             机器人层 (Robot Layer)                           │
├─────────────────────────────────────────────────────────────────────────────┤
│  机器人环境封装                     │  运动学/动力学模块                      │
│  ├── AirbotPlayBase                │  ├── AirbotPlayIK                      │
│  ├── MMK2Base                      │  ├── MMK2IK/FK/FIK                    │
│  ├── TOK2Base                      │  ├── TOK2IK                           │
│  ├── LeapHandBase                  │  └── ...                               │
│  └── ...                           │                                         │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                             引擎层 (Engine Layer)                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                            SimulatorBase (核心仿真引擎)                       │
│  ┌──────────────────┐  ┌──────────────────┐  ┌─────────────────────────────┐ │
│  │   物理仿真模块    │  │    渲染模块       │  │      传感器模块             │ │
│  │  ┌─────────────┐ │  │  ┌─────────────┐ │  │  ┌─────────────────────────┐ │ │
│  │  │   MuJoCo    │ │  │  │   OpenGL    │ │  │  │  RGB/Depth Camera      │ │ │
│  │  │  物理引擎   │ │  │  │   传统渲染  │ │  │  │  LiDAR Point Cloud     │ │ │
│  │  └─────────────┘ │  │  └─────────────┘ │  │  │  Tactile Sensor        │ │ │
│  │  ┌─────────────┐ │  │  ┌─────────────┐ │  │  └─────────────────────────┘ │ │
│  │  │ 碰撞检测    │ │  │  │  3D Gaussian│ │  │                             │ │
│  │  │ 时间积分    │ │  │  │  Splatting  │ │  │                             │ │
│  │  └─────────────┘ │  │  │  高保真渲染 │ │  │                             │ │
│  └──────────────────┘  │  └─────────────┘ │  └─────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                             工具层 (Utility Layer)                           │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────────┐ │
│  │  配置管理     │  │  状态机      │  │  控制器       │  │  数据处理         │ │
│  │ BaseConfig   │  │StateMachine  │  │ Controller   │  │ 轨迹记录         │ │
│  │ 参数设置     │  │ 任务流程     │  │ PID控制      │  │ 视频编码         │ │
│  └──────────────┘  └──────────────┘  └──────────────┘  │ 数据增强         │ │
│                                                         └──────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                           算法集成层 (Algorithm Layer)                        │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────────┐ │
│  │     ACT      │  │Diffusion     │  │     RDT      │  │   自定义算法      │ │
│  │  模仿学习    │  │ Policy      │  │ 大模型策略    │  │  用户扩展        │ │
│  │  Transformer │  │ 扩散模型     │  │ Transformer  │  │  算法接口        │ │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                         Real2Sim管道 (Real2Sim Pipeline)                     │
├─────────────────────────────────────────────────────────────────────────────┤
│  真实世界 → 3D重建 → 高斯散射模型 → 仿真环境 → 策略学习 → 真实部署           │
│     │         │         │           │         │           │                 │
│  ┌─────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────────────┐ │
│  │扫描 │ │3DGS训练 │ │.ply模型 │ │MJCF场景 │ │数据收集 │ │硬件部署(ROS)   │ │
│  │拍摄 │ │几何提取 │ │纹理材质 │ │物理仿真 │ │策略训练 │ │RealSense相机   │ │
│  └─────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 数据流图

```
┌─────────────┐    ┌─────────────────┐    ┌──────────────────┐
│   配置文件   │────▶│  SimulatorBase  │────▶│   物理状态更新    │
│ (BaseConfig)│    │   初始化        │    │  (MuJoCo step)   │
└─────────────┘    └─────────────────┘    └──────────────────┘
                                                    │
┌─────────────┐    ┌─────────────────┐    ┌──────────────────┘
│   MJCF场景   │────▶│   MuJoCo模型    │────┘
│    文件     │    │    加载         │
└─────────────┘    └─────────────────┘

┌─────────────┐    ┌─────────────────┐    ┌──────────────────┐
│   控制指令   │────▶│   机器人控制     │────▶│   关节位置/速度   │
│ (Action)   │    │  (IK/FK求解)    │    │   (Control)     │
└─────────────┘    └─────────────────┘    └──────────────────┘

┌─────────────┐    ┌─────────────────┐    ┌──────────────────┐
│  传感器配置  │────▶│   观测生成       │────▶│   图像/点云数据   │
│(obs_cam_id)│    │ (Rendering)     │    │  (Observation)  │
└─────────────┘    └─────────────────┘    └──────────────────┘

┌─────────────┐    ┌─────────────────┐    ┌──────────────────┐
│  域随机化    │────▶│   场景变化       │────▶│    数据增强      │
│(Randomain)  │    │(材质/光照/位置)  │    │  (Augmentation) │
└─────────────┘    └─────────────────┘    └──────────────────┘
```

## 模块依赖关系

```
                    ┌─────────────────┐
                    │   Applications  │
                    │   (具体任务)     │
                    └─────────┬───────┘
                              │ 继承
                    ┌─────────▼───────┐
                    │   TaskBase      │
                    │   (任务基类)     │
                    └─────────┬───────┘
                              │ 继承
                    ┌─────────▼───────┐
                    │   RobotBase     │
                    │   (机器人基类)   │
                    └─────────┬───────┘
                              │ 继承
                    ┌─────────▼───────┐
                    │ SimulatorBase   │
                    │  (仿真引擎)     │
                    └─────────┬───────┘
                              │ 使用
                    ┌─────────▼───────┐
                    │   BaseConfig    │
                    │   (配置基类)     │
                    └─────────────────┘

            依赖关系:
    MuJoCo ←── SimulatorBase ──→ 3DGS
       │            │              │
       ▼            ▼              ▼
    Physics    Observation    Rendering
    Engine      System        System
```

## 扩展接口示意

```
新机器人集成流程:

1. 运动学实现
   ┌─────────────────┐
   │  NewRobotIK     │
   │  (逆运动学)     │
   └─────────────────┘

2. 环境封装
   ┌─────────────────┐
   │  NewRobotBase   │ ←── 继承 SimulatorBase
   │  (基础环境)     │
   └─────────────────┘

3. 任务基类
   ┌─────────────────┐
   │NewRobotTaskBase │ ←── 继承 NewRobotBase
   │  (任务抽象)     │
   └─────────────────┘

4. 具体任务
   ┌─────────────────┐
   │SpecificTask     │ ←── 继承 NewRobotTaskBase
   │  (具体应用)     │
   └─────────────────┘
```